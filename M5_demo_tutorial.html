<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>M5 Docker Demo Tutorial - Interstellar Book</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <!--<link rel="stylesheet" href="fonts/fonts.css"> 
        <!-- added additionally to include custom font CSS -->
        <link rel="stylesheet" href="its-theme/fonts/BF_Modernista.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="its-theme/fonts/BF_Modernista.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="GCF.html"><strong aria-hidden="true">1.</strong> Garbled Circuit Factory - GCF</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="GC.html"><strong aria-hidden="true">1.1.</strong> Garbled Circuit Overview</a></li><li class="chapter-item expanded "><a href="VC-GC.html"><strong aria-hidden="true">1.2.</strong> Visual Cryptography Display</a></li><li class="chapter-item expanded "><a href="GCF_pipeline_detailed.html"><strong aria-hidden="true">1.3.</strong> Detailed Pipeline for Display Circuits</a></li><li class="chapter-item expanded "><a href="GCF_API.html"><strong aria-hidden="true">1.4.</strong> Garbled Circuit Factory APIs</a></li></ol></li><li class="chapter-item expanded "><a href="TTVP.html"><strong aria-hidden="true">2.</strong> Trusted Transaction Validation Protocol</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="TAUI.html"><strong aria-hidden="true">2.1.</strong> Trusted Authentication & UI Layer</a></li><li class="chapter-item expanded "><a href="TTVP_detailed.html"><strong aria-hidden="true">2.2.</strong> TTVP detailed</a></li><li class="chapter-item expanded "><a href="TTVP-TEE.html"><strong aria-hidden="true">2.3.</strong> TTVP in Hardware Enclave-TEE</a></li></ol></li><li class="chapter-item expanded "><a href="Mobile_Registry.html"><strong aria-hidden="true">3.</strong> Mobile Registry</a></li><li class="chapter-item expanded "><a href="Mobile_App.html"><strong aria-hidden="true">4.</strong> Mobile Wallet App</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="TTVP_client.html"><strong aria-hidden="true">4.1.</strong> TTVP Client</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="HBMK.html"><strong aria-hidden="true">4.1.1.</strong> Hardware-backed Mobile Key</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="Testing.html"><strong aria-hidden="true">5.</strong> Testing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="runtime_prerequisite.html"><strong aria-hidden="true">5.1.</strong> Runtime prerequisite</a></li><li class="chapter-item expanded "><a href="compilation_prerequisite.html"><strong aria-hidden="true">5.2.</strong> compilation prerequisite</a></li><li class="chapter-item expanded "><a href="M1.html"><strong aria-hidden="true">5.3.</strong> M1 Delivery</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="M1_demo_tutorial.html"><strong aria-hidden="true">5.3.1.</strong> M1 Docker Demo Tutorial</a></li></ol></li><li class="chapter-item expanded "><a href="M2.html"><strong aria-hidden="true">5.4.</strong> M2 Delivery</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="M2_demo_tutorial.html"><strong aria-hidden="true">5.4.1.</strong> M2 Docker Demo Tutorial</a></li></ol></li><li class="chapter-item expanded "><a href="M3.html"><strong aria-hidden="true">5.5.</strong> M3 Delivery</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="M3_demo_tutorial.html"><strong aria-hidden="true">5.5.1.</strong> M3 Docker Demo Tutorial</a></li></ol></li><li class="chapter-item expanded "><a href="M4.html"><strong aria-hidden="true">5.6.</strong> M4 Delivery</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="M4_demo_tutorial.html"><strong aria-hidden="true">5.6.1.</strong> M4 Docker Demo Tutorial</a></li></ol></li><li class="chapter-item expanded "><a href="M5.html"><strong aria-hidden="true">5.7.</strong> M5 Delivery</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="M5_demo_tutorial.html" class="active"><strong aria-hidden="true">5.7.1.</strong> M5 Docker Demo Tutorial</a></li></ol></li><li class="chapter-item expanded "><a href="GCF_API_Test_Guide.html"><strong aria-hidden="true">5.8.</strong> GCF APIs Testing Guide</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Interstellar Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="m5-demo-tutorial"><a class="header" href="#m5-demo-tutorial">M5 Demo Tutorial</a></h1>
<p>The purpose of this demo is to test the integration of the garbled circuit production in TEE nodes to demonstrate our core security finalized proof of concept.</p>
<p>As explained previously the garbling scheme implemeted on TEE nodes and android client is not yet optimized for display circuits like the previous one.</p>
<p>So we also provide a script client to test the garble circuit production on TEE nodes.</p>
<p>You can also test that the end to end solution with an android client. </p>
<blockquote>
<p>Although due to the current poor circuit evaluation performance, the validation screen is really difficult to read and does not reflect in any way the intended user experience</p>
</blockquote>
<h2 id="prerequiste"><a class="header" href="#prerequiste">prerequiste</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Install Docker</th><th>Install Podman</th></tr></thead><tbody>
<tr><td><a href="https://docs.docker.com/engine/install/">docker</a></td><td><a href="https://podman.io/getting-started/installation.html">podman</a></td></tr>
<tr><td><a href="https://docs.docker.com/compose/install/">docker-compose</a></td><td><a href="https://github.com/containers/podman-compose#podman-compose">podman-compose</a></td></tr>
</tbody></table>
</div>
<p>NOTE: usually when using <code>docker</code> or <code>docker-comppse</code> you MUST also use <code>sudo</code>; and conversely you MUST NOT be root with <code>podman</code> and <code>podman-compose</code></p>
<ul>
<li><code>sudo apt-get install jq</code></li>
</ul>
<h2 id="demo-with-script"><a class="header" href="#demo-with-script">Demo with script</a></h2>
<h3 id="1-launch-the-blockchain"><a class="header" href="#1-launch-the-blockchain">1. Launch the blockchain</a></h3>
<ul>
<li>
<p>prepare a temp folder eg: <code>mkdir interstellar_demo &amp;&amp; cd interstellar_demo</code></p>
</li>
<li>
<p>get the following docker compose file: <a href="https://github.com/Interstellar-Network/Interstellar-Book/blob/docker-compose/docker-compose.yml#L17">docker-compose.yml</a>
eg: <code>curl -o docker-compose.yml https://raw.githubusercontent.com/Interstellar-Network/Interstellar-Book/docker-compose/docker-compose.yml</code></p>
</li>
<li>
<p><em>needed only if using docker:</em> </p>
<p>-download also the following file, eg: <code>curl -o docker-ipfs-init.sh https://raw.githubusercontent.com/Interstellar-Network/Interstellar-Book/docker-compose/docker-ipfs-init.sh</code></p>
<p>-launch docker service:<code>sudo service docker start</code> </p>
<blockquote>
<p>podman does <strong>not</strong> require a service/daemon</p>
</blockquote>
</li>
<li>
<p>launch the full stack with the following command in the created directory: <br />
<code>sudo docker compose down --timeout 1 &amp;&amp; sudo docker compose up --force-recreate</code> <br />
<strong>NOTE:</strong> replace <code>docker compose</code> with <code>podman-compose</code> if you want to use podman instead of docker</p>
</li>
<li>
<p>wait a few seconds until you see this kind of lines repeating:</p>
</li>
</ul>
<pre><code>2022-10-05 14:17:12 [ocw-circuits] Hello from pallet-ocw-circuits.
2022-10-05 14:17:12 [ocw-circuits] nothing to do, returning...
2022-10-05 14:17:12 💤 Idle (0 peers), best: #6 (0x369f…bfea), finalized #3 (0xa66a…6fa2), ⬇ 0 ⬆ 0
[+] Received finalized header update (4), syncing parent chain...
[+] Found 1 block(s) to sync
Synced 4 out of 4 finalized parentchain blocks
[+] Found 0 block(s) to sync
</code></pre>
<h3 id="optional-15-launch-a-generic-substrate-front-end"><a class="header" href="#optional-15-launch-a-generic-substrate-front-end">[optional] 1.5 Launch a generic Substrate Front-end</a></h3>
<p>Use the following <a href="https://substrate-developer-hub.github.io/substrate-front-end-template/?rpc=ws://localhost:9990">substrate link</a> or <a href="https://polkadot.js.org/apps/?rpc=ws%3A%2F%2Flocalhost%3A9990#/chainstate">polkadot</a> to launch a substrate front end
that will connect to the node running in <code>docker-compose</code></p>
<blockquote>
<p>when using WSL: you <strong>MUST</strong> use <code>localhost</code> <strong>NOT</strong> <code>127.0.0.1</code> else the forwarding windows -&gt; wsl -&gt; docker/podman will not work [if you directly clicked on the given links it is already set, but be careful if you use another front-end]</p>
</blockquote>
<blockquote>
<p>avoid some browser extensions that could generate interface issues</p>
</blockquote>
<h3 id="2-run-the-integritee-demo-script"><a class="header" href="#2-run-the-integritee-demo-script">2. Run the integritee demo script</a></h3>
<ul>
<li>create a docker/podman volume:<br />
<code>sudo docker volume create KeyStoreVolume1</code></li>
<li>get the demo script:
<ul>
<li>for consistency, make sure you are in the directory created at &quot;prepare a temp folder&quot; above</li>
<li><code>curl https://raw.githubusercontent.com/Interstellar-Network/integritee-worker/interstellar/cli/demo_interstellar.sh -o demo_interstellar.sh</code></li>
<li><code>chmod +x demo_interstellar.sh</code></li>
</ul>
</li>
<li>check which network docker-compose/podman-compose is using:<br />
<code>sudo docker container inspect --format '{{range $net,$v := .NetworkSettings.Networks}}{{printf &quot;%s\n&quot; $net}}{{end}}' interstellar_demo-integritee_service-1</code>
<ul>
<li>it should return for example: <code>interstellar_demo_default</code></li>
<li>if it fails: use <code>docker ps</code> and replace <code>interstellar_demo-integritee_service-1</code> in the previous command by the correct name</li>
</ul>
</li>
<li>run the demo (twice): <code>CLIENT_BIN=&quot;sudo docker run --network interstellar_demo_default --name integritee_cli -v KeyStoreVolume1:/usr/local/bin/my_trusted_keystore --rm ghcr.io/interstellar-network/integritee_cli:milestone4&quot; ./demo_interstellar.sh -V wss://integritee_service -p 9990 -u ws://integritee_node -P 2090</code> <br />
<strong>IMPORTANT</strong> the <code>--network</code> parameter MUST match the result of the previous command <code>docker container inspect</code><br />
<strong>NOTE</strong> replace <code>sudo docker</code> by <code>podman</code> in <code>CLIENT_BIN=</code> if needed
<ul>
<li>the first time you start the demo it should say:</li>
</ul>
<pre><code>[...]
OCW_CIRCUITS_STORAGE: null
OCW_CIRCUITS_STORAGE is NOT initialized
MUST call extrinsic 'ocwCircuits::submitConfigDisplayCircuitsPackageSigned'
Calling 'ocwCircuits::submitConfigDisplayCircuitsPackageSigned'
Extrinsic started: wait a few seconds(~5-10s) and restart this script
</code></pre>
<ul>
<li>wait a few seconds</li>
<li>check docker-compose/podman-compose logs; you should see something like</li>
</ul>
<pre><code>2022-10-05T14:35:08.974284Z DEBUG hyper::proto::h1::conn: incoming body is chunked encoding
2022-10-05T14:35:08.974294Z DEBUG hyper::proto::h1::decode: incoming chunked header: 0x82 (130 bytes)
2022-10-05T14:35:09.019290Z DEBUG hyper::proto::h1::conn: incoming body completed
2022-10-05T14:35:09.019378Z DEBUG hyper::proto::h1::role: response with HTTP2 version coerced to HTTP/1.1
2022-10-05T14:35:09.019433Z DEBUG hyper::proto::h1::io: flushed 220 bytes
2022-10-05 14:35:09 [fetch_from_remote_grpc_web] status code: 200, content_type: application/grpc-web+proto
2022-10-05 14:35:09 [fetch_from_remote_grpc_web] header: content-type application/grpc-web+proto
2022-10-05 14:35:09 [fetch_from_remote_grpc_web] header: transfer-encoding chunked
2022-10-05 14:35:09 [fetch_from_remote_grpc_web] header: date Wed, 05 Oct 2022 14:35:08 GMT
2022-10-05 14:35:09 [ocw-circuits] callback_new_skcd_signed sent number : 1
</code></pre>
it MUST say &quot;callback_new_skcd_signed sent number : <strong>1</strong>&quot; NOT <strong>0</strong></li>
<li>re-run the script</li>
<li>when asked for inputs <code>Inputs to use? [space separated list of int; eg 0 1 2 3]</code>
<ul>
<li>enter a space-separated list of digits eg <code>4 2</code></li>
<li>if you used invalid inputs, you will see eg <code>Trusted call 0x7275e5e0fe5812ee9560a6b23469fe3007af3a080b11f88ad71c66364393f6d8 is Invalid</code></li>
<li>if the used the correct code, you will see eg <code>Trusted call 0xbd86033441f672f15d6cfedd3180d1da21c86aa46469e0d4eadb6daa673b87bc is InSidechainBlock(0xb8795299ef99d5501f6d9767b9fee012c6342be2435440a598bebd6b49260951)</code></li>
</ul>
</li>
</ul>
<h4 id="note-how-to-get-the-correct-code"><a class="header" href="#note-how-to-get-the-correct-code">NOTE: How to get the correct code</a></h4>
<p>When the script is waiting for inputs, check the docker-compose logs for something like:</p>
<pre><code>[2022-10-05T14:41:43Z INFO  pallet_tx_validation::pallet] [tx-validation] store_metadata_aux: who = , message_pgarbled_cid = &quot;QmbcKoDVkFQDQRDJgwd7HWMgbJ5GnurEZgDEUivn9Fsf5Y&quot;, message_digits = [9, 7], pinpad_digits = [8, 4, 6, 7, 3, 1, 5, 2, 9, 0]
</code></pre>
<ul>
<li>In this example the correct code is <code>[9, 7]</code> and the permutation of the pinpad are <code>[8, 4, 6, 7, 3, 1, 5, 2, 9, 0]</code>
<ul>
<li>NOTE: if you go back to the previous milestone demo, that is the order of the digit displayed on the Android app</li>
</ul>
</li>
</ul>
<p><img src="./fig/random-keypad.svg" alt="random keypad" /></p>
<ul>
<li><code>9</code> is the <u>eighth</u> digit in the list(0-indexed) and <code>7</code> the <u>third</u> one</li>
<li>you must enter <code>8 3</code> when prompted</li>
</ul>
<h2 id="demo-with-android-client"><a class="header" href="#demo-with-android-client">Demo with Android client</a></h2>
<h3 id="1-launch-the-blockchain-1"><a class="header" href="#1-launch-the-blockchain-1">1. Launch the blockchain</a></h3>
<p>Create a directory</p>
<p>example:</p>
<pre><code>mkdir blockchain_demo
</code></pre>
<p>and add the following docker compose configuration file: <a href="https://github.com/Interstellar-Network/Interstellar-Book/blob/docker-compose/docker-compose.yml">docker-compose.yml</a> in it.</p>
<p>Then start docker or podman</p>
<pre><code>sudo service docker start
</code></pre>
<p>and then </p>
<pre><code>cd blockchain_demo
</code></pre>
<p>and launch the blockchain demo with <code>ipfs</code> and  api services i.e. <code>api_circuits</code> </p>
<pre><code>docker-compose down --timeout 1 &amp;&amp; docker-compose up --force-recreate
</code></pre>
<blockquote>
<p>replace <code>docker-compose</code> with <code>podman-compose</code> if you are using podman instead of docker</p>
</blockquote>
<h3 id="2-launch-a-generic-substrate-fromt-end"><a class="header" href="#2-launch-a-generic-substrate-fromt-end">2. Launch a generic Substrate Fromt-end</a></h3>
<p>Use the following <a href="https://substrate-developer-hub.github.io/substrate-front-end-template/?rpc=ws%3A%2F%2Flocalhost%3A9944">substrate link</a> to launch substrate front end</p>
<p>to connect to a locally running node</p>
<blockquote>
<p>avoid some browser extensions that could generate interface issues</p>
</blockquote>
<h3 id="3-install-the-wallet-app-ie-apk-file-on-an-android-device-or-an-emulator"><a class="header" href="#3-install-the-wallet-app-ie-apk-file-on-an-android-device-or-an-emulator">3. Install the wallet App i.e APK file on an android device or an emulator</a></h3>
<h4 id="31-retrieve-the-apk-file"><a class="header" href="#31-retrieve-the-apk-file">3.1 Retrieve the APK file</a></h4>
<p>Download the <a href="https://github.com/Interstellar-Network/wallet-app/releases/tag/milestone5">APK file</a></p>
<h4 id="32-install-the-apk"><a class="header" href="#32-install-the-apk">3.2 Install the APK</a></h4>
<h5 id="321-on-an-android-device"><a class="header" href="#321-on-an-android-device">3.2.1 on an android device</a></h5>
<p><a href="https://www.lifewire.com/install-apk-on-android-4177185">How to install an APK on Android</a></p>
<p>WARNING: ensure that your device is configure for english.</p>
<h5 id="322-on-an-windows-emulator"><a class="header" href="#322-on-an-windows-emulator">3.2.2 on an windows emulator</a></h5>
<p><a href="https://developer.android.com/studio/">Install Android studio</a></p>
<p>Install the pixel 5 API 31 emulator with Virtual Device Manager or any <code>x86_64</code> emulator.</p>
<h4 id="342-launch-the-emulator"><a class="header" href="#342-launch-the-emulator">3.4.2 Launch the emulator</a></h4>
<p><img src="./fig/Android_device_manager.png" alt="Launch pixel 5 API 31 emulator" /></p>
<p>Wait for the emulator to launch and emulated device to power on and drag and drop the APK file on the emulator to install the App.</p>
<h3 id="4-ensure-that-wallet-can-connect-to-the-blockchain"><a class="header" href="#4-ensure-that-wallet-can-connect-to-the-blockchain">4. Ensure that wallet can connect to the blockchain</a></h3>
<blockquote>
<p>The app is currently a dev version, so it expects the servers(RPC/WS, and IPFS) to be on localhost.</p>
</blockquote>
<p>Which is obviously not the case when running on Device/Emulator.</p>
<p>To remedy <code>adb reverse</code> will expose &quot;<code>localhost</code> of the desktop&quot; as &quot;<code>localhost</code> of the device&quot;.</p>
<blockquote>
<p>Then, IF the blockchain(docker-compose) are NOT running on the desktop, you need to expose them. It can be done e.g. using ssh port forwarding, or through some other means.</p>
</blockquote>
<p><img src="./fig/config-localhost-device.svg" alt="config-localhost-device" /></p>
<p>Following is a configuration example with a windows desktop that run an android emulator and a WSL/VM running the blockchain(docker-compose)</p>
<p>adb is installed by default with android studio.
So you just need to set-up its path on the OS used, if it is not already set.</p>
<p>Just connect the phone with an USB port or through WiFi( cf android studio).</p>
<p>on the OS where the emulator is running or the device is connected:</p>
<pre><code>adb reverse tcp:9990 tcp:9990
</code></pre>
<pre><code>adb reverse tcp:2090 tcp:2090 
</code></pre>
<pre><code>adb reverse tcp:5001 tcp:5001
</code></pre>
<p>to expose server desktop on emulator</p>
<p>on the OS where blocchain is installed:</p>
<p>example if  blockchain run on WSL2</p>
<pre><code> export WSL_HOST_IP=&quot;$(tail -1 /etc/resolv.conf | cut -d' ' -f2)&quot;
</code></pre>
<p>and use SSH to connect to the emulator running on windows or android devices connected to adb through USB port or WiFi:</p>
<pre><code>ssh -N -R 9944:localhost:9944 -R 5001:localhost:5001 [windows_user_name]@$WSL_HOST_IP
</code></pre>
<p>TROUBLESHOOTING: start the front-end
<a href="https://substrate-developer-hub.github.io/substrate-front-end-template/?rpc=ws%3A%2F%2Flocalhost%3A9944">substrate link</a>
on your Device/Emulator to check it works properly.
Otherwise fix network issues.</p>
<h2 id="demo-purpose"><a class="header" href="#demo-purpose">Demo purpose</a></h2>
<p>The purpose of this demo is to show how a mobile wallet can use the <a href="./TTVP_Client.html">Trusted Transaction Protocol client</a> to confirm a transaction in a higly secure and hardware-backed trusted way on a smartphone device.</p>
<p>We focus on demonstrating:</p>
<ol>
<li>The registration of the mobile device on the blockchain mobile registry.</li>
<li>The confirmation of a transaction through the TTVP protocol and the execution of the core low-level TTVP client on a smartphone device.</li>
</ol>
<blockquote>
<p>The purpose of the demo is not yet to show a fully functional wallet. We want to demonstrate that the TTVP protocol and Trusted Authentication and UI Layer is working as expected with our substrate based blockchain pallets to authenticate and confirm transactions or sensible operations.</p>
</blockquote>
<h2 id="start-the-demo"><a class="header" href="#start-the-demo">Start The demo</a></h2>
<h2 id="1-generate-with-ocwcircuits-the-configuration-display-circuit-package"><a class="header" href="#1-generate-with-ocwcircuits-the-configuration-display-circuit-package">1. Generate with <code>ocwCircuits</code> the configuration display circuit package</a></h2>
<blockquote>
<p>IMPORTANT: when interacting with pallets you MUST use the Signed button in blue to sign all the transactions, not SUDO, neither Unsigned</p>
</blockquote>
<blockquote>
<p>this is almost the same step one of the M2 delivery demo tutorial except that it generate of package of circuirts.</p>
</blockquote>
<p>It set-up the configuration display circuit package used by the Garble Circuit Factory to generate randomized keyboard and message with one time code for each transactions.</p>
<h3 id="11--select-ocwcircuits-pallet"><a class="header" href="#11--select-ocwcircuits-pallet">1.1  Select ocwCircuits pallet</a></h3>
<p><img src="./fig/select-ocwCircuits.png" alt="circuit select" /></p>
<h3 id="12-select-submitconfigdisplaypackagesigned-extrinsic"><a class="header" href="#12-select-submitconfigdisplaypackagesigned-extrinsic">1.2 select submitConfigDisplayPackageSigned extrinsic</a></h3>
<p><img src="./fig/select-circuit-display-package.png" alt="circuit select" /></p>
<h3 id="13-sign-transaction"><a class="header" href="#13-sign-transaction">1.3 Sign transaction</a></h3>
<p><img src="./fig/ocw-sign.png" alt="circuit sign" /></p>
<h3 id="13-the-cid-of-the-circuit-package-generated-appears-in-events"><a class="header" href="#13-the-cid-of-the-circuit-package-generated-appears-in-events">1.3 The cid of the circuit package generated appears in Events</a></h3>
<p><img src="./fig/ocw-show-event.png" alt="circuit sign" /></p>
<h2 id="2-launch-android-app"><a class="header" href="#2-launch-android-app">2. Launch Android App</a></h2>
<p>Swipe from bottom to top and click on <code>Wallet Interstellar</code></p>
<img src="./fig/SelectAndroidApp.png" alt="wallet menu"  width="120"/>
<h2 id="3-send-a-currency-and-wait-for-the-transaction-confirmation-screen-to-validate-the-transaction"><a class="header" href="#3-send-a-currency-and-wait-for-the-transaction-confirmation-screen-to-validate-the-transaction">3. Send a Currency and wait for the Transaction confirmation screen to validate the transaction</a></h2>
<h3 id="31-select-currency-and-contact"><a class="header" href="#31-select-currency-and-contact">3.1 Select currency and contact</a></h3>
<p>Following is an explicit video showing how to send a curency to a contact
on SEND screen.</p>
<img src="./fig/Send_Currency_Demo.gif" alt="wallet menu"  width="300"/>
<h3 id="32-click-on-the-blue-check-icon"><a class="header" href="#32-click-on-the-blue-check-icon">3.2 Click on the blue Check icon</a></h3>
<h3 id="33-wait-for-the-transaction-validation-screen-to-appear-and-type-the-two-digits-one-time-code"><a class="header" href="#33-wait-for-the-transaction-validation-screen-to-appear-and-type-the-two-digits-one-time-code">3.3 Wait for the transaction validation screen to appear and type the two-digits one-time-code</a></h3>
<h3 id="34-check-toast-message-order"><a class="header" href="#34-check-toast-message-order">3.4 check Toast message order</a></h3>
<ul>
<li>Processing...</li>
<li>Registered</li>
<li>[error] No circuits available after 10s; exiting!</li>
</ul>
<p>[after taping one-time code digits]</p>
<ul>
<li>Validating transaction...</li>
<li>Transaction done!</li>
</ul>
<p>NOTE:</p>
<blockquote>
<p>The wallet app is still work in progress and we have still some little issues to fix between the low level layer in rust and C++, especially on the renderer to connect with the Kotlin/Swift UI layer.</p>
</blockquote>
<p>We want to avoid writting code that won't be used in the final version. For this reason we have made some little shortcut to demonstrate the execution of validation screen based on Garbled Circuits package eveluation.</p>
<blockquote>
<p>As a result we do not show yet the inputted amount and the transaction beneficiary in the message. Although the transaction validation screen is fully functional.</p>
</blockquote>
<blockquote>
<p>Remark: Regarding the beneficiary of the transaction, we will implement a trusted beneficiary feature: a user will be able to create a trusted beneficiary contact whose public address will be registered in the blockchain through a sensitive operation message validation.</p>
</blockquote>
<p>This makes the classic public key address substitution impossible for an attacker. Bad actors won't be able to replace a contact name by their own public key.
Moreover, it makes the usage of the wallet much more user friendly and safer.</p>
<h2 id="4-check-that-mobile-public-key-is-registered-on-the-mobile-registry-pallet"><a class="header" href="#4-check-that-mobile-public-key-is-registered-on-the-mobile-registry-pallet">4. Check that mobile public key is registered on the mobile registry pallet</a></h2>
<h3 id="41-copy-the-account-key-in-mobileregistry-events"><a class="header" href="#41-copy-the-account-key-in-mobileregistry-events">4.1 Copy the <code>account key</code> in MobileRegistry Events</a></h3>
<p>When the mobile is registered with an account, its mobile public key is stored on mobileRegistryMap in <code>MobileRegistry</code> pallet and an event is generated</p>
<p><img src="./fig/MobileRegistryEvent.png" alt="circuit sign" /></p>
<blockquote>
<p>underline in red</p>
</blockquote>
<h3 id="42-select-mobileregistry-pallet"><a class="header" href="#42-select-mobileregistry-pallet">4.2 select mobileRegistry pallet</a></h3>
<p>and mobileRegistryMap Query (not extrinsic)</p>
<p><img src="./fig/select-MobileRegistry.png" alt="circuit sign" /></p>
<p>Then  paste the copied <code>account key</code></p>
<p><img src="./fig/MobileRegistryQuery.png" alt="circuit sign" /></p>
<p>When the Query is completed you will see the mobile public key associated with the device as a result.</p>
<blockquote>
<p>this public key is used to verify the hardware-backed signature of the transaction confirmation message that includes position typed by the user on the randomized keypad</p>
</blockquote>
<h2 id="5-check-mobile-users-ínput-and-transaction-status-on-the-front-end"><a class="header" href="#5-check-mobile-users-ínput-and-transaction-status-on-the-front-end">5. Check Mobile user's ínput and transaction status on the front-end</a></h2>
<p>Check the events</p>
<h3 id="51-transaction-success"><a class="header" href="#51-transaction-success">5.1 Transaction Success</a></h3>
<p>you will see in the events
<img src="./fig/TransactionSuccess.png" alt="circuit sign" />
if the one-time-code was entered properly</p>
<h3 id="52-transaction-fail"><a class="header" href="#52-transaction-fail">5.2 Transaction Fail</a></h3>
<p>you will see in the events
<img src="./fig/TransactionFail.png" alt="circuit sign" />
if the one-time-code was wrong</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="M5.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="GCF_API_Test_Guide.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="M5.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="GCF_API_Test_Guide.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>

        <script src="ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
