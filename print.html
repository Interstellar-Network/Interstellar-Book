<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded affix "><a href="introduction.html">Introduction</a></li><li class="expanded affix "><a href="M1.html">Milestone 1</a></li><li class="expanded affix "><a href="GCF.html">Garbled Circuit Factory- GCF</a></li><li class="expanded "><a href="GC.html"><strong aria-hidden="true">1.</strong> Garbled Circuit Overview</a></li><li class="expanded "><a href="GCF_pipeline_detailed.html"><strong aria-hidden="true">2.</strong> Detailed Pipeline for display circuits</a></li><li class="expanded "><a href="GCF_API.html"><strong aria-hidden="true">3.</strong> Garbled Circuit Factory API</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title"></h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <picture>
  <source 
    srcset="fig/Interstellar-White-Text.png" 
    media="(prefers-color-scheme: dark)">
  <img src="fig/Interstellar-Black-Text.png">
</picture>
<h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>“The blockchain ecosystem needs an easy to use interface with hardware wallet security to reach the mass market.”</p>
<p>The main pain points of non-custodial wallet solutions still are:</p>
<ul>
<li><strong>User experience</strong>  <a href="https://medium.com/@jlleleu/can-be-an-easy-to-set-up-wallet-an-efficient-customer-acquisition-tool-for-defi-players-8600812fe01e">Can an easy to set-up wallet be an efficient customer acquisition tool for DeFi players?</a></li>
<li><strong>Security</strong> <a href="https://medium.com/@jlleleu/are-cryptocurrency-wallets-more-at-risk-than-ever-cf1ce9725de7">Are cryptocurrency wallets more at risk than ever?</a> </li>
</ul>
<blockquote>
<p>We think that current wallet solutions slow down the DeFi adoption.</p>
</blockquote>
<p>Interstellar is a novel non-custodial peace of mind mobile wallet with a hardware security level. Based on a Substrate blockchain and SubstraTEE/IntegriTEE workers.</p>
<p><strong>We can now provide the same hardware security level as hardware wallets with only a mobile and a blockchain</strong></p>
<picture>
  <source 
    srcset="https://user-images.githubusercontent.com/4605611/145108720-becb76be-6c16-46c8-af69-7e953e5a166d.png" 
    media="(prefers-color-scheme: dark)">
  <img src="https://user-images.githubusercontent.com/4605611/145108818-6f8b6158-6c27-4f0d-a104-9d2469c73636.png">
</picture>
<p><strong>Thanks to Trusted User Interface TUI on mobile and Trusted Execution Environment on both mobile and blockchain nodes</strong></p>
<p>Because TUI is not yet avalaible on all mobile devices we use a Garbled Circuit/Visual Cryptography scheme which provides an alternative that will be complementary down the road to mitigate potential flaws in TUI.</p>
<picture>
  <source 
    srcset="https://user-images.githubusercontent.com/4605611/145201585-5d106219-e51e-44d3-8c1b-95fe99e71455.png" 
    media="(prefers-color-scheme: dark)">
  <img src="https://user-images.githubusercontent.com/4605611/145201886-30bafb07-fc1c-4dc0-acf9-f0e9f163fa66.png">
</picture>
<!-- ![Iphone-Android-TUI-White (1)](https://user-images.githubusercontent.com/4605611/145201585-5d106219-e51e-44d3-8c1b-95fe99e71455.png#gh-dark-mode-only)

![Iphone-Android-TUI-Black (1)](https://user-images.githubusercontent.com/4605611/145201886-30bafb07-fc1c-4dc0-acf9-f0e9f163fa66.png#gh-light-mode-only) -->
<h4><a class="header" href="#features" id="features">Features:</a></h4>
<ul>
<li>
<p><strong>Hardware security Level</strong> - TEE on nodes and mobiles (incl. TUI), garbled circuits and visual cryptography secure interface</p>
</li>
<li>
<p><strong>Just download an app</strong> - no registration, PIN, password, passphrase, private key or any secret to store or remember</p>
</li>
<li>
<p><strong>Multichain Wallet</strong> - securely store and interact with native cryptocurrency coins and tokens from multiple blockchains</p>
</li>
<li>
<p><strong>Confirm a transaction with ONLY ONE SCREEN</strong> - no SMS to wait for, no additional 2FA app to use, no QR code to scan</p>
</li>
<li>
<p><strong>Up to 1,000,000 tps</strong> - no tps limit due to slow consensus, thanks to IntegriTEE layer 2 based on hardware enclave technology </p>
</li>
<li>
<p><strong>Social Recovery Service</strong> - leverages the existing Substrate pallet and a novel decentralized autonomous recovery service </p>
</li>
</ul>
<blockquote>
<p>We hope that we will be able to provide a response to the related RFP in the following phases</p>
</blockquote>
<ul>
<li><strong>Features to securely send coins with social network messages (even to persons with no-wallet)</strong> - explained in <a href="https://medium.com/@jlleleu/can-be-an-easy-to-set-up-wallet-an-efficient-customer-acquisition-tool-for-defi-players-8600812fe01e">Can an easy to set-up wallet be an efficient customer acquisition tool for DeFi players?</a> </li>
</ul>
<h4><a class="header" href="#our-solution-is-designed-to-support-blockchain-and-defi-mass-market-adoption-with" id="our-solution-is-designed-to-support-blockchain-and-defi-mass-market-adoption-with">Our solution is designed to support blockchain and DeFi mass market adoption with:</a></h4>
<ul>
<li><strong>A decentralized key &amp; asset management service</strong> where the user’s privates keys and signature programs are stored and executed in TEE nodes</li>
<li><strong>A decentralized Trusted Transaction Validation protocol</strong> that leverages TEE and TUI features on mobile, combined with One Time Garbled Circuits and Visual Cryptography to provide a <strong>Trusted Authentication and Trusted UI layer</strong> on user devices</li>
</ul>
<h1><a class="header" href="#milestone-1" id="milestone-1">Milestone 1</a></h1>
<h1><a class="header" href="#intoduction-to-garbled-circuit-factory-gcf" id="intoduction-to-garbled-circuit-factory-gcf">Intoduction to Garbled Circuit Factory (GCF)</a></h1>
<p>The Garble Circuit Factory is the module in charge of building the Garbled Circuits (GC) used by Interstellar infrastructure.</p>
<p>Following is a high level overview of the genric pipeline used to generate GC.</p>
<p><img src="./fig/GCF_pipeline.svg" alt="PIPELINEHL" /></p>
<h1><a class="header" href="#garbled-circuit-overview" id="garbled-circuit-overview">Garbled Circuit Overview</a></h1>
<h2><a class="header" href="#basic-garbled-circuit-structure-overview" id="basic-garbled-circuit-structure-overview">Basic Garbled Circuit structure overview</a></h2>
<p>A garbled circuit is a cryptographic obfuscation technique and a cryptographic algorithm that ensures computation privacy i.e. manages the protection of a boolean circuit that can be executed without leaking information. Neither the semantics of boolean operators (AND, OR, XOR, etc.) that make up the circuit nor the semantics of inputs and outputs of the circuit will be revealed to the attackers through reverse-engineering or brute force attacks.</p>
<p><img src="./fig/Garbled_Circuit.jpg" alt="GC" /></p>
<ul>
<li>Inputs and outputs are Garbled Values i.e. 128 bits token indistinguishable from random with a secret semantic value of 0 or 1 only known by the nodes</li>
<li>Each boolean operator is implemented in the circuit by an encrypted truth table, decrypted by its respective Garbled Values inputs.</li>
</ul>
<p><a href="https://www.cs.fsu.edu/%7Etvhoang/thesis.pdf">Foundation of Garbled Circuits, Viet Tung Hoang, B.S.</a></p>
<h1><a class="header" href="#detailed-pipeline-for-display-circuits" id="detailed-pipeline-for-display-circuits">Detailed Pipeline for Display Circuits</a></h1>
<h2><a class="header" href="#pipeline" id="pipeline">Pipeline</a></h2>
<p>Overview : </p>
<p>[1] Generate “segment2pixel.v” using internal code [using e.g. 7segs.png]
[2] Verilog  → .blif : combine all Verilog(xorexpand+rndswitch+segment2pixel) using Yosys
[3] .blif → .blif.blif : optimization /synthesis : using ABC
[4] Parsing .blif → .skcd : using internal code
[5] Garbling .skcd → .garbled : using JustGarble
[6] Finalize/Serialize .garbled → .pgarbled : Using internal code; allows for parallel eval of a Garbled Circuit</p>
<p>NOTE: the file types are mentioned for clarity and to allow matching with calling the executables (e.g. Yosys or ABC) manually, but in practice after [2] all is done in memory, and cached.</p>
<p><img src="./fig/pipeline_detailed_display.svg" alt="GCF detailed" /></p>
<h3><a class="header" href="#1-generate-segment2pixelv" id="1-generate-segment2pixelv">[1] Generate “segment2pixel.v”</a></h3>
<p>Note : this is the only file in the pipeline that needs to be regenerated when changing size/resolution. The rest (xorexpand+rndswitch+segment2pixel) are static, and the size/resolution is handled by passing the appropriate “`define” to Yosys.
This allows to cache the resulting .skcd of the whole pipeline (cf CircuitDisplayGenerator::GenerateDisplay) using “segment2pixel.v” content as cache key.</p>
<p>TODO clarify
7segs.png (or other) is parsed from an embedded resource into the executable, and prepared for later use (and some pre-computation is done based on the colors of the .png)
???
CircuitDisplayGenerator::GenerateSegmentToPixelVerilog 
A “bitmap” is generated with the correct number of digits at the correct positions [in relative coords]
E.g. 2-4 digits in the center of the “message window”, and 10 digits vertically oriented for the “pinpad window”
If there is an in-memory .skcd cached for this particular “segment2pixel.v” it is returned and that part is done	</p>
<h3><a class="header" href="#234-generate-skcd" id="234-generate-skcd">[2][3][4] Generate .skcd</a></h3>
<p>If there is no cached .skcd for the step [1], one is generated cf CircuitDisplayGenerator::GenerateDisplay</p>
<p>The big steps are self-explanatory (pretty much just calling ABC or Yosys, and handling/parsing the results or errors; most of the business logic is in step [1]) :
'''C++
if (is_message) {
YosysHelper::CompileVerilog(MESSAGE_SEGMENT2PIXELS_V,
MESSAGE_SEGMENT2PIXELS_V &quot;.blif&quot;);
} else {
YosysHelper::CompileVerilog(PINPAD_SEGMENT2PIXELS_V,
PINPAD_SEGMENT2PIXELS_V &quot;.blif&quot;);
}</p>
<p>GenerateDefineVerilog(is_message, msgsize, nb_segments, circuit_display_size);</p>
<p>CompileVerilogHelpers(is_message);</p>
<p>ConcatBlifs(is_message);</p>
<p>RunAbc(is_message);</p>
<p>// when segment2pixels cache is disabled, nothing to do, we can return
if (!allow_cache) {
return Blif2Skcd(is_message);
}</p>
<p>// segment2pixels enabled: we need to store the new entry into the SkcdCache
Skcd skcd = Blif2Skcd(is_message);
skcd_cache_-&gt;Set(hash_segment2pixels, skcd);
return skcd;
'''</p>
<p>if (is_message) {
YosysHelper::CompileVerilog(MESSAGE_SEGMENT2PIXELS_V,
MESSAGE_SEGMENT2PIXELS_V &quot;.blif&quot;);
} else {
YosysHelper::CompileVerilog(PINPAD_SEGMENT2PIXELS_V,
PINPAD_SEGMENT2PIXELS_V &quot;.blif&quot;);
}</p>
<p>GenerateDefineVerilog(is_message, msgsize, nb_segments, circuit_display_size);</p>
<p>CompileVerilogHelpers(is_message);</p>
<p>ConcatBlifs(is_message);</p>
<p>RunAbc(is_message);</p>
<p>// when segment2pixels cache is disabled, nothing to do, we can return
if (!allow_cache) {
return Blif2Skcd(is_message);
}</p>
<p>// segment2pixels enabled: we need to store the new entry into the SkcdCache
Skcd skcd = Blif2Skcd(is_message);
skcd_cache_-&gt;Set(hash_segment2pixels, skcd);
return skcd;</p>
<h3><a class="header" href="#56-garbling" id="56-garbling">[5][6] Garbling</a></h3>
<p>Technically garbling + “stripping” (i.e. generating the “pre-packmsg”).
This is at this step that the pinpad/OTP randomness is introduced, i.e. the .skcd generated at the previous step CAN/SHOULD be reused (and it is) all the time (i.e. it is always reused, except when changing size or resolution).</p>
<p>In production, the “stripped circuits” are what is sent to a device ahead of time and the “pre-packmsg” is stored in the DB.
Then when creating a transaction, the “pre-packmsg” is used to generate the correct “packmsg” with the desired transaction  message (e.g. “Do you authorize sending X BTC to Y address”), and then send it to the Device.
The Device then combines the “packmsg” and the “stripped circuits” and proceed to evaluate the circuits (= generating the final bitmap, one for each frame at the target 60+ FPS).</p>
<p>TODO if we stop sending the circuits ahead of time (i.e. the generation is fast enough, and the size small enough to be able to get them on the spot even on a mobile), we COULD probably remove the whole “2 steps” concept of stripped circuits + packmsg. There is indeed no point in sending both the packmsg and the stripped circuit in the same payload.</p>
<h2><a class="header" href="#circuit-pipeline-api" id="circuit-pipeline-api">Circuit Pipeline API</a></h2>
<p>Implemented with GRPC because why not?
With a gateway (TODO Envoy or gprc-gateway?)
Gateway needed because there is no no_std HTTP2 client in Rust
There are indeed a few no_std Protobuf libs out there(eg https://github.com/tokio-rs/prost/blob/978fb03f05f9927b43d6d402044f9fb41a9addb3/README.md#using-prost-in-a-no_std-crate and https://github.com/tafia/quick-protobuf), but this is only half the required parts.</p>
<p>Why an API instead of directly calling lib_server from Rust in the OCW ?
Because lib_server is GPL, and we don’t really want to contaminate everything with GPL
Because there is no (easy) way to call something as big as lib_server in a no_std context anyway
[and because the OCW will need to read/write in a DB/IPFS and there is probably no easy way to do that in a no_std context]</p>
<h1><a class="header" href="#garbled-cicuit-factory-api" id="garbled-cicuit-factory-api">Garbled Cicuit Factory API</a></h1>
<p>This is a list of APIs used in substrate framework to pilot the generation of the Garbled Circuits needed by the Interstellar infrsstructure.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
